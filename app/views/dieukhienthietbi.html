<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Điều khiển Thiết bị</title>

<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200;300;400;500;600;700;800&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>

<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        primary: "#45cf17",
        "background-main": "#ffffff",
        "surface-offset": "#f8f9fa",
        "border-beige": "#dcded5",
        "text-main": "#111827",
        "text-sub": "#6b7280",
        "status-green": "#22c55e",
        "status-yellow": "#eab308",
        "status-red": "#ef4444"
      },
      fontFamily: {
        display: ["Manrope", "sans-serif"]
      }
    }
  }
};
</script>

<style>
.material-symbols-outlined {
  font-variation-settings: 'FILL' 0,'wght' 400,'GRAD' 0,'opsz' 24;
}
</style>
</head>

<body class="font-display bg-background-main text-text-main">

<div class="min-h-screen flex flex-col">

<header class="flex items-center justify-between border-b border-border-beige px-6 py-3 bg-white shadow-sm">
  <div class="flex items-center gap-4">
    <a href="/middle" class="flex h-10 w-10 items-center justify-center rounded-lg bg-primary/10 hover:bg-primary/20">
      <span class="material-symbols-outlined text-primary">arrow_back</span>
    </a>

    <div class="size-6 text-primary">
      <svg fill="currentColor" viewBox="0 0 24 24">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15v-4H8l4-5v4h3l-4 5z"/>
      </svg>
    </div>

    <h2 class="text-lg font-bold">Lớp Học Thông Minh</h2>
  </div>
</header>

<main class="flex-1 px-6 py-10">
<div class="max-w-5xl mx-auto">

<div class="mb-8">
  <h1 class="text-4xl font-black">Điều khiển Thiết bị</h1>
  <p class="text-text-sub mt-1">Quản lý trạng thái các thiết bị trong phòng học</p>
</div>

<div class="grid grid-cols-1 sm:grid-cols-2 gap-6">

<!-- ĐÈN -->
<div class="relative rounded-xl border border-border-beige bg-white p-6 shadow-sm"
     id="den-card">

  <div class="absolute top-0 inset-x-0 h-1.5 bg-primary"></div>

  <div class="flex justify-between items-center">
    <div class="flex gap-4 items-center">
      <div class="size-12 rounded-lg bg-primary/10 flex items-center justify-center text-primary">
        <span class="material-symbols-outlined text-3xl">lightbulb</span>
      </div>

      <div>
        <p class="text-lg font-bold">Đèn</p>

        <div class="flex items-center gap-2">
          <div id="den-dot" class="size-2 rounded-full"></div>
          <p id="den-status" class="text-sm font-medium"></p>
        </div>
      </div>
    </div>

    <label class="inline-flex items-center cursor-pointer">
      <input
        type="checkbox"
        id="den-switch"
        class="sr-only peer"
      />
      <div class="w-12 h-7 bg-slate-200 rounded-full peer-checked:bg-primary
                  relative after:absolute after:top-1 after:left-1
                  after:h-5 after:w-5 after:bg-white after:rounded-full
                  after:transition peer-checked:after:translate-x-5">
      </div>
    </label>
  </div>
</div>


<!-- MÁY CHIẾU -->
<div class="relative rounded-xl border border-border-beige bg-white p-6 shadow-sm"
     id="maychieu-card">

  <div class="absolute top-0 inset-x-0 h-1.5 bg-primary"></div>

  <div class="flex justify-between items-center">
    <div class="flex gap-4 items-center">
      <div class="size-12 rounded-lg bg-primary/10 flex items-center justify-center text-primary">
        <span class="material-symbols-outlined text-3xl">videocam</span>
      </div>

      <div>
        <p class="text-lg font-bold">Máy chiếu</p>

        <div class="flex items-center gap-2">
          <div id="maychieu-dot" class="size-2 rounded-full"></div>
          <p id="maychieu-status" class="text-sm font-medium"></p>
        </div>
      </div>
    </div>

    <label class="inline-flex items-center cursor-pointer">
      <input
        type="checkbox"
        id="maychieu-switch"
        class="sr-only peer"
      />
      <div class="w-12 h-7 bg-slate-200 rounded-full peer-checked:bg-primary
                  relative after:absolute after:top-1 after:left-1
                  after:h-5 after:w-5 after:bg-white after:rounded-full
                  after:transition peer-checked:after:translate-x-5">
      </div>
    </label>
  </div>
</div>


<!-- Ổ ĐIỆN -->
<div class="relative rounded-xl border border-border-beige bg-white p-6 shadow-sm"
     id="odien-card">

  <div class="absolute top-0 inset-x-0 h-1.5 bg-primary"></div>

  <div class="flex justify-between items-center">
    <div class="flex gap-4 items-center">
      <div class="size-12 rounded-lg bg-primary/10 flex items-center justify-center text-primary">
        <span class="material-symbols-outlined text-3xl">outlet</span>
      </div>

      <div>
        <p class="text-lg font-bold">Ổ điện</p>

        <div class="flex items-center gap-2">
          <div id="odien-dot" class="size-2 rounded-full"></div>
          <p id="odien-status" class="text-sm font-medium"></p>
        </div>
      </div>
    </div>

    <label class="inline-flex items-center cursor-pointer">
      <input
        type="checkbox"
        id="odien-switch"
        class="sr-only peer"
      />
      <div class="w-12 h-7 bg-slate-200 rounded-full peer-checked:bg-primary
                  relative after:absolute after:top-1 after:left-1
                  after:h-5 after:w-5 after:bg-white after:rounded-full
                  after:transition peer-checked:after:translate-x-5">
      </div>
    </label>
  </div>
</div>


<!-- ĐIỀU HÒA -->
<div class="relative rounded-xl border border-border-beige bg-white p-6 shadow-sm"
     id="dieuhoa-card">

  <div class="absolute top-0 inset-x-0 h-1.5 bg-primary"></div>

  <div class="flex justify-between items-center">
    <div class="flex gap-4 items-center">
      <div class="size-12 rounded-lg bg-primary/10 flex items-center justify-center text-primary">
        <span class="material-symbols-outlined text-3xl">ac_unit</span>
      </div>

      <div>
        <p class="text-lg font-bold">Điều hòa</p>

        <div class="flex items-center gap-2">
          <div id="dieuhoa-dot" class="size-2 rounded-full"></div>
          <p id="dieuhoa-status" class="text-sm font-medium"></p>
        </div>
      </div>
    </div>

    <label class="inline-flex items-center cursor-pointer">
      <input
        type="checkbox"
        id="dieuhoa-switch"
        class="sr-only peer"
      />
      <div class="w-12 h-7 bg-slate-200 rounded-full peer-checked:bg-primary
                  relative after:absolute after:top-1 after:left-1
                  after:h-5 after:w-5 after:bg-white after:rounded-full
                  after:transition peer-checked:after:translate-x-5">
      </div>
    </label>
  </div>
</div>


</div>
</div>
</main>

</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* 1. Firebase init */
firebase.initializeApp({
  databaseURL: "https://loracontrol-7f0e1-default-rtdb.asia-southeast1.firebasedatabase.app/"
});
const db = firebase.database();

/* 2. Hàm bind thiết bị (chuẩn hóa tuyệt đối) */
function bindDevice(key) {
  const ref = db.ref(`devices/${key}/state`);

  const sw   = document.getElementById(`${key}-switch`);
  const txt  = document.getElementById(`${key}-status`);
  const dot  = document.getElementById(`${key}-dot`);

  if (!sw || !txt || !dot) {
    console.warn(`Thiếu HTML element cho thiết bị: ${key}`);
    return;
  }

  /* Firebase → UI (REALTIME) */
  ref.on("value", snap => {
    const state = snap.val() === true;

    sw.checked = state;
    txt.textContent = state ? "Đang bật" : "Đang tắt";

    txt.className =
      "text-sm font-medium " +
      (state ? "text-status-green" : "text-status-red");

    dot.className =
      "size-2 rounded-full " +
      (state ? "bg-status-green" : "bg-status-red");
  });

  /* UI → Firebase */
  sw.addEventListener("change", () => {
    ref.set(sw.checked);
  });
}

/* 3. Khai báo danh sách thiết bị */
["den", "maychieu", "odien", "dieuhoa"].forEach(bindDevice);
</script>

</body>
</html>
